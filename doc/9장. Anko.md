## 9.1 Anko 소개

- JetBrain에서 직접 제작한 코틀린 라이브러리
- 앱 개발에 유용한 유틸리티 함수 제공
- 성격에 따라 네 종류의 라이브러리 제공
  - Anko Commons
  - Anko Layouts
  - Anko SQLite
  - Anko Coroutines

## 9.2 Anko Commons

- 앱을 구현할 때 일반적으로 자주 사용하는 기능을 간편하게 추가할 수 있는 유틸리티 함수 제공

- 의존성 추가

  ```
  android {
      ...
  }

  dependencies {
      // Anko Commons 라이브러리 추가
      compile "org.jetbrains.anko:anko-commons:0.10.2"
      ...
  }
  ```

- 서포트 라이브러리에 포함된 클래스를 사용하는 경우, 필요에 따라 아래와 같은 의존성을 추가

  ```
  android {
      ...
  }

  dependencies {
      compile "org.jetbrains.anko:anko-commons:0.10.2"
      
      // appcompat-v7용 Anko Commons 라이브러리
      compile "org.jetbrains.anko:anko-appcompat-v7-commons:0.10.2"
      
      // support-v4용 Anko Commons 라이브러리
      compile "org.jetbrains.anko:anko-support-v4-commons:0.10.2"
  }
  ```

### 토스트 표시하기

- `toast()`, `longToast()` 함수 사용

- `Context` 클래스의 인스턴스를 가진 or 상속 받은 클래스 내부에서만 사용 가능

- 예제

  ```kotlin
  // Toast.makeText(Context, "Hello, Kotlin", Toast.LENGTH_SHORT).show()
  toast("Hello, Kotlin!")

  // Toast.makeText(Context, R.string.hello, Toast.LENGTH_SHORT).show()
  toast(R.string.hello)

  // Toast.makeText(Contest, "Hello, Kotlin", Toast.LENGTH_LONG).show()
  longToast("Hello, Kotlin!")
  ```

### 다이얼로그 생성 및 표시하기

- `alert()` 함수를 사용하면 `AlertDialog` 생성 가능

- `Context` 클래스에 대한 것은 토스트와 동일

- 예제

   ```kotlin
  alert(title = "Message", message = "Let`s learn Kotlin!") {
      positiveButton("Yes") {
          toast("Yay!")
      }
      
      negativieButton("No") {
          longToast("No way...")
      }
  }.show()
   ```

- 서포트 라이브러리에서 제공하는 다이얼로그를 생성할 경우, `title` 인자 앞에 `AppCompat`을 인자로 추가하면 됨

  ```kotlin
  // import 문 추가
  import org.jetbrains.anko.appcompat.v7.Appcompat

  alert(Appcompat, ...) {
      ...
  }.show()
  ```

- 여러 개 항목을 선택하도록 할 때는 리스트 다이얼로그 생성 함수인 `selector()`를 사용

  ```kotlin
  val citites = listOf("Seoul", "Tokyo", "Mountain View", "Singapore")

  selector(title = "Select City", items = citites) { dlg, selection -> 
      toast("You selected ${cities[selection]}!")
  }
  ```

- 진행 상태를 표시할 때는 `progressDialog()` 함수와 `indeterminateProgressDialog()` 함수를 사용하여 생성

  - `progressDialog()` 함수는 __진행률 표시__
  - `indeterminateProgressDialog()` 함수는 __진행률 미표시__

  ```kotlin
  val pd = progressDialog(title = "File Download", message = "Downloading...")
  pd.show()
  pd.progress = 50

  indeterminateProgressDialog(message = "Please wait...").show()
  ```

### 인텐트 생성 및 사용하기

- 기존의 `Intent` 설정을 `intentFor()` 함수를 통해 간소한 형태로 동일한 역할을 할 수 있음

  ```kotlin
  val intent = intentFor<DetailActivity>("id" to 150L, "title" to "Awesome item")
      .noHistory()
  ```

- 인텐트 플래그를 지정하지 않는다면, `startActivity()` 함수나 `startService()` 함수를 사용하여 생성과 동시과 컴포넌트 호출을 동시에 수행 가능

- 이는 `Context` 클래스가 필요

  ```kotlin
  startActivity<DetailActivity>()
  startActivity<DetailActivity>("id" to 150L, "title" to "Awesome item")

  startService<DataSyncService>()
  startService<DataSyncService>("id" to 1000L)
  ```

- 이 외에도 자주 사용하는 특정 작업을 바로 수행할 수 있는 함수 제공

  ```kotlin
  // 전화 걸기
  makeCall(number = "01012345678")

  // 문자 발송
  sendSMS(number = "01012345678", text = "Hello, Kotlin!")

  // 웹 페이지 오픈
  browse(url = "https://google.com")

  // 이메일 발송
  email(email = "jyte82@gmail.com", subject = "Hello, Taeho Kim",
       text = "How are you?")
  ```

### 로그 메시지 기록하기

- 기존 `android.util.Log` 클래스에서 제공하는 메서드 사용시 항상 태그를 입력해야 함

- `AnkoLogger`를 사용하면 훨씬 편리하게 로그 메시지 기록 가능

- `AnkoLogger`는 메시지에 모든 타입을 허용

- 예제

  ```Kotlin
  class MainActivy : AppCompatActivity, AnkoLogger {
      // 로그 태그를 바꾸고 싶은 경우 loggerTag를 오버라이드
      override val loggerTag: String
          get() = "Main"
      
      fun doSomething() {
          info("doSomething() called")
      }
      
      fun doSomethingWithParameter(number: Int) {
          debug(number)
      }
  }
  ```

### 단위 변환

- __dp__나 __sp__를 __픽셀__로 변환하는 함수를 제공

  ```kotlin
  val dpInPixel = dip(100)

  val spInPixel = sp(16)
  ```

- 반대의 경우도 함수를 제공

  ```kotlin
  val pxInDip = px2dip(300)

  val pxInSp = px2sp(80)
  ```

### 기타

- `configuration()` 함수를 사용하면 특정 단말기 환경일 때 실행할 코드를 간단하게 구현 가능
- OS 버전 분기를 수행하는 `doFromSdk()` 함수, `doIfSdk()` 함수 제공



### 9.3 Anko Layouts

- DSL로 레이아웃을 구현할 수 있음
  - XML로 레이아웃 작성 시, 파싱 과정에서 자원이 더 필요함 (배터리라던지...)
  - 확실히 XML 레이아웃 작성보다 코드로 작성하는 것이 더 복잡하고 까다로움
- Anko Layouts의 라이브러리는 모듈의 __minSdkVersion__에 영향을 받음
  - minSdkVersion에 대응되는 목록은 p.171 표 참고

### DSL로 화면 구성하기

- 예제

  ```kotlin
  class MainActivity : AppCompatActivity() {
      override fun onCreate(savedInstanceState: Bundle?) {
          super.onCreate(savedInstanceState)
          
          verticalLayout {
              padding = dip(22)
              
              textView("Enter Login Credentials")
              
              editText {
                  hint = "E-main"
              }
              
              editText {
                  hint = "Password"
              }
              
              button("Submit")
          }
      }
  }
  ```

  - `Fragment`에서도 사용할 수 있음

  - `AnkoComponent` 클래스를 상속 받아 DSL로 구현한 뒤 `Activity`나 `Fragment`에서 사용 가능

    ```kotlin
    class MainActivityUI : AnkoComponent<MainActivity> {
        override fun createView(ui: AnkoContext<MainActivity>) = ui.apply {
            // DSL 코드
        }.view
    }

    class MainActivity : AppCompatActivity {
        override fun onCreate(savedInstanceState: Bundle?) {
            ...
            
            MainActivityUI().setContentView(this)
        }
    }
    ```

-  미리 보기 지원

  - __View > Tools Windows > Anko Layout Preview__ 선택