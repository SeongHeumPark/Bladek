## 15.1 의존성 주입과 대거 라이브러리

### 의존성 주입

- 특정 객체의 인스턴스가 필요한 경우, 이를 직접 생성하지 않고 외부에서 생성된 객체를 전달하는 기법
- 이점
  - 목적에 따라 동작 변경이 쉬움
  - 생선한 객체를 쉽게 재사용 가능
  - 객체를 생성하거나 사용할 때 발생할 수 있는 실수를 줄여줌

### 대거 라이브러리

- 각 객체 간의 의존 관계를 __어노테이션__을 사용하여 정의
- __어노테이션 프로세서__를 통해 문제가 없는지 분석 절차를 거침

#### 모듈

- 필요한 객체를 제공하는 역할

- `@Module` 어노테이션을 클래스에 추가

- 해당 모듈에서 제공하는 객체를 정의한 함수는 `@Provides` 어노테이션을 추가해야 함

  ```kotlin
  @Module
  class BurgerModule {
      @Privodies
      fun provideBuger(bun: Bun, patty: Patty): Bugar {
          return Burger(bun, patty)
      }
      
      @Provides
      fun provideBun(): Bun {
          return WhatBun()
      }
      
      @Provides
      fun providePatty() : Patty {
          return BeefPatty()
      }
  }
  ```

#### 컴포넌트

- 모듈에서 제공받은 객체를 조합하여 필요한 곳에 주입하는 역할

- `@Component` 어노테이션을 붙인 __인터페이스__로 선언

- `modules` 프로퍼티를 통해 컴포넌트에 객체를 제공하는 모듈을 지정할 수 있음

  ```kotlin
  @Component(modules = arrayOf(BurgerModule::class))
  interface FastFoodComponent {
      fun inject(store: Store)
  }
  ```

- 컴포넌트를 통해 객체를 주입받는 항목은 `@Inject` 어노테이션으로 표시

- __컴포넌트가 값을 주입하는 시점에 객체가 할당__되므로 주입 받는 프로퍼티는 `lateinit var`로 선언

  ```kotlin
  class Store {
      @Inject lateinit var burger: Burger
      
      init {
          DaggerFastFoodComponent
  	        .builder()
          	.bugerModule(BurgerModule())
          	.build()
          	.inject(store = this)
      }
  }
  ```

  - `DaggerFastFoodComponent` 클래스는 `FastFoodComponent`의 콘트리트 클래스 _p.349~350 참고_

- 모듈에서 직접 제공할 수 없지만 객체 그래프에 추가해야 하는 객체가 있는 경우 _ex. `Activity`, `Application`_
  __컴포넌트__를 통해 필요한 객체를 전달하는 방식으로 문제를 해결할 수 있음

- __컴퍼넌트 빌더 인터페이스__는 `@Component.Builder` 어노테이션을 명시하는 __인터페이스__
  반드시 `build()` 메서드가 포함되어야 함

- `Builder` 클래스를 반환하는 함수에는 `@BindInstance` 어노테이션을 추가햐아 함

  ```kotlin
  @Component(modules = arrayOf(BurgerModule::class))
  interface FastFoodComponent {
  	@Component.Builder
      interface Builder {
          @BindInstnace
          fun application(app: Application): Builder
          
          fun build(): FastFoodComponent
      }
      
      fun inject(store: Store)
  }
  ```

  ```kotlin
  class FoodApp : Application {
      @Inject lateinit var burger: Burger
      
      override fun onCreate() {
          super.onCreate()
          
          DaggerFastFoodComponent
          	.builder()
          	.application(app = this)
          	.build()
          	.inject(app = this)
      }
  }
  ```

  ​